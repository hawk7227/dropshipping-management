{% comment %}
  Competitor Badge Snippet
  Shows a small badge with savings vs competitor
  
  Usage: {% render 'competitor-badge', product: product %}
  
  Requires metafields:
  - product.metafields.competitor.price (number)
  - product.metafields.competitor.source (string)
{% endcomment %}

{% assign competitor_price = product.metafields.competitor.price | default: 0 %}
{% assign competitor_source = product.metafields.competitor.source | default: "Amazon" %}
{% assign our_price = product.price | divided_by: 100.0 %}

{% if competitor_price > 0 and competitor_price > our_price %}
  {% assign savings_percent = competitor_price | minus: our_price | divided_by: competitor_price | times: 100 | round %}
  
  {% if savings_percent >= 5 %}
    <div class="competitor-badge" style="
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
    ">
      {% comment %} Checkmark Icon {% endcomment %}
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
      <span>{{ savings_percent }}% less than {{ competitor_source }}</span>
    </div>
  {% endif %}
  
{% elsif competitor_price > 0 and competitor_price < our_price %}
  {% comment %} We're more expensive - show price match badge instead {% endcomment %}
  {% assign difference_percent = our_price | minus: competitor_price | divided_by: competitor_price | times: 100 | round %}
  
  {% if difference_percent <= 10 %}
    <div class="competitor-badge" style="
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f3f4f6;
      color: #374151;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid #e5e7eb;
    ">
      <span>Competitive with {{ competitor_source }}</span>
    </div>
  {% endif %}
{% endif %}
