{% comment %}
  Stock Alert Snippet
  Shows low stock / out of stock warnings
  
  Usage: {% render 'stock-alert', product: product, variant: variant %}
  
  Settings:
  - Low stock threshold: 10 units (configurable below)
{% endcomment %}

{% assign low_stock_threshold = 10 %}
{% assign very_low_threshold = 3 %}

{% comment %} Get inventory quantity {% endcomment %}
{% if variant %}
  {% assign inventory_qty = variant.inventory_quantity | default: 0 %}
  {% assign inventory_policy = variant.inventory_policy %}
{% else %}
  {% assign inventory_qty = product.variants.first.inventory_quantity | default: 0 %}
  {% assign inventory_policy = product.variants.first.inventory_policy %}
{% endif %}

{% comment %} Check if inventory tracking is enabled {% endcomment %}
{% assign track_inventory = true %}
{% if inventory_policy == 'continue' %}
  {% assign track_inventory = false %}
{% endif %}

{% if track_inventory %}
  {% comment %} OUT OF STOCK {% endcomment %}
  {% if inventory_qty <= 0 %}
    <div class="stock-alert stock-alert--out" style="
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 8px;
      color: #991b1b;
      font-size: 14px;
      margin: 12px 0;
    ">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <div>
        <strong>Out of Stock</strong>
        <div style="font-size: 12px; color: #b91c1c; margin-top: 2px;">
          Enter your email to be notified when back in stock
        </div>
      </div>
    </div>
    
    {% comment %} Back in Stock Email Form {% endcomment %}
    <form class="back-in-stock-form" style="margin-top: 8px;">
      <div style="display: flex; gap: 8px;">
        <input 
          type="email" 
          placeholder="Enter your email" 
          required
          style="
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
          "
        >
        <button 
          type="submit"
          style="
            padding: 10px 20px;
            background: #111;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
          "
        >
          Notify Me
        </button>
      </div>
    </form>
  
  {% comment %} VERY LOW STOCK (1-3 units) {% endcomment %}
  {% elsif inventory_qty <= very_low_threshold %}
    <div class="stock-alert stock-alert--critical" style="
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      color: #92400e;
      font-size: 14px;
      margin: 12px 0;
      animation: pulse 2s infinite;
    ">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
        <line x1="12" y1="9" x2="12" y2="13"></line>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
      <div>
        <strong>Only {{ inventory_qty }} left!</strong>
        <div style="font-size: 12px; color: #b45309; margin-top: 2px;">
          Order now before it's gone
        </div>
      </div>
    </div>
  
  {% comment %} LOW STOCK (4-10 units) {% endcomment %}
  {% elsif inventory_qty <= low_stock_threshold %}
    <div class="stock-alert stock-alert--low" style="
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: #fffbeb;
      border: 1px solid #fde68a;
      border-radius: 6px;
      color: #a16207;
      font-size: 13px;
      margin: 12px 0;
    ">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>Low stock - only {{ inventory_qty }} remaining</span>
    </div>
  
  {% comment %} IN STOCK (normal) {% endcomment %}
  {% else %}
    <div class="stock-alert stock-alert--available" style="
      display: flex;
      align-items: center;
      gap: 6px;
      color: #059669;
      font-size: 13px;
      margin: 8px 0;
    ">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <span>In Stock - Ready to Ship</span>
    </div>
  {% endif %}
{% else %}
  {% comment %} No inventory tracking - always available {% endcomment %}
  <div class="stock-alert stock-alert--available" style="
    display: flex;
    align-items: center;
    gap: 6px;
    color: #059669;
    font-size: 13px;
    margin: 8px 0;
  ">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    <span>In Stock</span>
  </div>
{% endif %}

<style>
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }
  
  .back-in-stock-form button:hover {
    background: #374151 !important;
  }
</style>
